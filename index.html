<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca Compartida de PDF (Base de Datos)</title>
    <!-- Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 2rem;
        }
        .pdf-viewer {
            width: 100%;
            height: 80vh; /* Ocupa el 80% de la altura de la vista */
            max-width: 900px;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        @media (max-width: 768px) {
            .pdf-viewer {
                height: 70vh;
            }
        }
    </style>
</head>
<body>

    <!-- Contenedor Principal -->
    <div class="max-w-4xl w-full p-4">

        <!-- T√≠tulo -->
        <div class="bg-indigo-600 text-white p-6 rounded-t-xl shadow-lg mb-4 text-center">
            <h1 class="text-3xl font-extrabold mb-1">
                üìö Biblioteca Compartida de PDFs
            </h1>
            <p class="text-indigo-200">Usando Base de Datos en Tiempo Real (Firestore)</p>
        </div>

        <!-- Estado de Firebase (Secci√≥n de debug) -->
        <div class="bg-white p-4 rounded-xl shadow-md mb-6">
            <h2 class="text-lg font-semibold text-gray-700 mb-2">Estado de la Conexi√≥n</h2>
            <div id="auth-status" class="text-sm p-2 rounded bg-indigo-100 text-indigo-700">Autenticaci√≥n: Inicializando...</div>
            <div id="user-id" class="text-sm p-2 mt-2 rounded bg-green-100 text-green-700">ID Usuario: Desconocido</div>
        </div>

        <!-- Cargador de PDF (M√©todo Simple para prueba est√°tica) -->
        <div class="bg-yellow-50 p-4 rounded-xl shadow-md mb-6 border border-yellow-200">
            <h2 class="text-xl font-bold text-yellow-800 mb-2">PDF de Prueba Est√°tico</h2>
            <p class="text-sm text-yellow-700">
                **Ubicaci√≥n:** <code class="bg-yellow-200 p-1 rounded font-mono text-xs">prueba.pdf</code>
            </p>
            <div id="pdf-message" class="mt-2 text-sm text-gray-600">
                Cargando PDF...
            </div>
        </div>

        <!-- Visor de PDF -->
        <div id="pdf-container" class="pdf-viewer">
            <!-- El PDF.js cargar√° el iframe o el elemento aqu√≠ -->
        </div>

    </div>

    <!-- Firebase Imports -->
    <script type="module">
        // Importaciones de Firebase (Necesarias para la base de datos y autenticaci√≥n)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- VARIABLES GLOBALES DEL ENTORNO (NO MODIFICAR) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app;
        let auth;
        let db;
        let currentUserId = 'ID no disponible';

        // Elementos del DOM
        const authStatusEl = document.getElementById('auth-status');
        const userIdEl = document.getElementById('user-id');
        const pdfMessageEl = document.getElementById('pdf-message');

        // --- 1. Inicializaci√≥n de Firebase ---
        if (firebaseConfig) {
            try {
                // Inicializar la aplicaci√≥n
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                authStatusEl.textContent = 'Autenticaci√≥n: Inicializada.';
                userIdEl.textContent = 'ID Usuario: Conectando...';
            } catch (error) {
                console.error("Error al inicializar Firebase:", error);
                authStatusEl.textContent = `Error de Inicializaci√≥n: ${error.message}`;
            }
        } else {
            authStatusEl.textContent = 'Error: Configuraci√≥n de Firebase no encontrada.';
        }

        // --- 2. Autenticaci√≥n An√≥nima/Estable ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuario autenticado (usaremos el token o el inicio de sesi√≥n an√≥nimo)
                currentUserId = user.uid;
                authStatusEl.textContent = 'Autenticaci√≥n: ‚úÖ Conectado exitosamente.';
                userIdEl.textContent = `ID Usuario (UID): ${currentUserId}`;
            } else {
                // Si no hay usuario, intenta iniciar sesi√≥n de forma an√≥nima
                signInAnonymously(auth)
                    .then(() => {
                        // El onAuthStateChanged se disparar√° de nuevo con el usuario an√≥nimo
                    })
                    .catch((error) => {
                        console.error("Error al iniciar sesi√≥n an√≥nima:", error);
                        authStatusEl.textContent = `Error de Autenticaci√≥n: ${error.message}`;
                        userIdEl.textContent = 'ID Usuario: No autenticado';
                    });
            }
        });


        // --- 3. Cargador de PDF (Funci√≥n de prueba) ---
        function loadPdfViewer(url) {
            const pdfContainer = document.getElementById('pdf-container');
            
            // La URL ahora apunta a la RA√çZ donde tienes 'prueba.pdf'
            const pdfUrl = url; 

            // Esta es la URL del visor PDF.js alojado por Mozilla
            const viewerUrl = `https://mozilla.github.io/pdf.js/web/viewer.html?file=${encodeURIComponent(pdfUrl)}`;

            // Crear el iframe para cargar el visor
            const iframe = document.createElement('iframe');
            iframe.src = viewerUrl;
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            iframe.style.borderRadius = '0.75rem';

            // Limpiar y a√±adir el iframe
            pdfContainer.innerHTML = '';
            pdfContainer.appendChild(iframe);

            pdfMessageEl.innerHTML = `PDF cargado correctamente desde <code class="bg-yellow-200 p-1 rounded font-mono text-xs">${pdfUrl}</code>. ¬°Revisa tu URL!`;
        }

        // Cargar el PDF de prueba
        // Nota: Solo se carga el archivo est√°tico de prueba para confirmar que GitHub Pages funciona.
        // La l√≥gica de Firestore vendr√° despu√©s.
        window.onload = () => {
             // La URL del PDF est√°tico, asumiendo que est√° en la RA√çZ (junto al index.html)
            loadPdfViewer('prueba.pdf'); 
        };

        // TODO: En el siguiente paso, a√±adiremos la l√≥gica de Firestore aqu√≠ para guardar y listar PDFs.

    </script>
</body>
</html>
